<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NPCs & Map - Orientation | Pixels Dojo Wiki</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/npcs.css">
    <link rel="stylesheet" href="/css/chat-widget.css">
    <style>
      .orientation-tabs {
        display: flex;
        gap: 1rem;
        margin: 2rem 0;
        justify-content: center;
        flex-wrap: wrap;
      }
      
      .tab-button {
        padding: 1rem 2rem;
        background: rgba(20, 20, 40, 0.8);
        border: 2px solid rgba(0, 255, 255, 0.3);
        border-radius: 8px;
        color: white;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      
      .tab-button:hover {
        border-color: var(--cyan);
        background: rgba(0, 255, 255, 0.1);
      }
      
      .tab-button.active {
        background: var(--cyan);
        color: black;
        border-color: var(--cyan);
      }
      
      .tab-content {
        display: none;
      }
      
      .tab-content.active {
        display: block;
      }

      .map-guide-section {
        background: rgba(20, 20, 40, 0.6);
        border: 2px solid rgba(0, 255, 255, 0.2);
        border-radius: 12px;
        padding: 2rem;
        margin: 2rem 0;
      }

      .map-guide-section h2 {
        color: var(--cyan);
        margin-bottom: 1.5rem;
      }

      .map-guide-section img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin: 1rem 0;
      }
    </style>
</head>
<body>
   <%- include('partials/header') %>

<nav>
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/category/startup">Start Here</a></li>
    <li><a href="/category/earn">Earn $PIXEL</a></li>
    <li><a href="/category/mastery">Mastery</a></li>
    <li><a href="/npcs-map">NPCs & Map</a></li>
    <li><a href="/events">Events</a></li>
    <li><a href="/amas">AMAs</a></li>
    <li><a href="/category/community">Community</a></li>
  </ul>
</nav>

    <div class="container">
        <div class="npc-header">
            <h1>üó∫Ô∏è Orientation: NPCs & Map</h1>
            <p class="subtitle">Get to know the people and places of TerraVilla</p>
        </div>

        <!-- Tab Navigation -->
        <div class="orientation-tabs">
          <button class="tab-button active" onclick="switchTab('npcs')">
            üé≠ NPC Directory
          </button>
          <button class="tab-button" onclick="switchTab('map')">
            üó∫Ô∏è TerraVilla Map Guide
          </button>
        </div>

        <!-- NPCs Tab -->
        <div id="npcs-tab" class="tab-content active">
          <div class="sort-controls" style="margin: 1.5rem 0; text-align: center;">
            <strong>Sort by:</strong>
            <a href="/npcs-map?sort=name" class="<%= currentSort === 'name' ? 'active' : '' %>">Name A‚ÄìZ</a> |
            <a href="/npcs-map?sort=name-desc" class="<%= currentSort === 'name-desc' ? 'active' : '' %>">Name Z‚ÄìA</a> |
            <a href="/npcs-map?sort=location" class="<%= currentSort === 'location' ? 'active' : '' %>">Location A‚ÄìZ</a> |
            <a href="/npcs-map?sort=location-desc" class="<%= currentSort === 'location-desc' ? 'active' : '' %>">Location Z‚ÄìA</a> |
            <a href="/npcs-map" class="<%= !currentSort || currentSort === 'display_order' ? 'active' : '' %>">Default Order</a>
          </div>
          
          <div class="npc-grid">
              <% npcs.forEach(npc => { %>
                  <div class="npc-card">
                      <div class="npc-image">
                          <img src="<%= npc.image_path %>" alt="<%= npc.name %>" 
                               onerror="this.src='/images/npcs/default-npc.png'">
                      </div>
                      <div class="npc-info">
                          <h3 class="npc-name"><%= npc.name %></h3>
                          <p class="npc-location">üìç <%= npc.location %></p>
                          <% if (npc.description) { %>
                              <p class="npc-description"><%= npc.description %></p>
                          <% } %>
                      </div>
                  </div>
              <% }); %>
          </div>

          <% if (npcs.length === 0) { %>
              <div class="no-npcs">
                  <p>No NPCs have been added yet. Check back soon!</p>
              </div>
          <% } %>
        </div>

        <!-- Map Tab -->
        <div id="map-tab" class="tab-content">
          <div class="map-guide-section">
            <% if (mapGuide) { %>
              <h2><%= mapGuide.title %></h2>
              <div class="post-meta" style="color: #b0b0ff; margin-bottom: 1.5rem;">
                By <%= mapGuide.author_display_name || 'Pixels Dojo' %> 
                ¬∑ Last updated: <%= new Date(mapGuide.updated_at).toLocaleDateString() %>
              </div>
              <div class="map-content">
                <%- mapGuide.content %>
              </div>
              <div style="text-align: center; margin-top: 2rem;">
                <a href="/pages/<%= mapGuide.slug %>" 
                   style="display: inline-block; padding: 1rem 2rem; background: var(--cyan); color: black; 
                          border-radius: 8px; text-decoration: none; font-weight: bold;">
                  View Full Map Guide ‚Üí
                </a>
              </div>
            <% } else { %>
              <p style="text-align: center; color: #b0b0ff;">
                Map guide coming soon! Check back later.
              </p>
            <% } %>
          </div>
        </div>
    </div>
<%- include('partials/back-to-top') %>
    <%- include('partials/footer') %>
    <script src="/js/chat-widget.js"></script>

    <script>
      function switchTab(tab) {
        // Update buttons
        document.querySelectorAll('.tab-button').forEach(btn => {
          btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // Update content
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.getElementById(tab + '-tab').classList.add('active');
        
        // Update URL without reload
        const url = new URL(window.location);
        url.searchParams.set('tab', tab);
        window.history.pushState({}, '', url);
      }

      // Check URL for tab parameter on load
      window.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);
        const tab = params.get('tab');
        if (tab === 'map') {
          document.querySelector('.tab-button').classList.remove('active');
          document.querySelectorAll('.tab-button')[1].classList.add('active');
          document.getElementById('npcs-tab').classList.remove('active');
          document.getElementById('map-tab').classList.add('active');
        }
      });
    </script>
</body>
</html>
